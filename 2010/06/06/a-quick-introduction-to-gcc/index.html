<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sinujohn">
<meta name="description" content="GCC - GNU Compiler Collection From GCC manual - When you invoke GCC, it normally does preprocessing, compilation, assembly and linking. Compile and Link a simple program:
gcc -o hello.out hello.c  This creates an executable &amp;lsquo;hello.out&amp;rsquo; from file &amp;lsquo;hello.c&amp;rsquo; -o specifies the output file. Specify Language: Create a C file and save it as &amp;lsquo;hello.cpp&amp;rsquo;.
gcc -o hello.out hello.cpp  This results in an error as gcc tries to perform C&#43;&#43; compilation(assumed from the extension ." />
<meta name="keywords" content=", C, gcc, linux" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://sinujohn.github.io/2010/06/06/a-quick-introduction-to-gcc/" />


    <title>
        
            A quick introduction to GCC :: Sinu John  — A simple theme for Hugo
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">




    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="A quick introduction to GCC">
<meta itemprop="description" content="GCC - GNU Compiler Collection From GCC manual - When you invoke GCC, it normally does preprocessing, compilation, assembly and linking. Compile and Link a simple program:
gcc -o hello.out hello.c  This creates an executable &lsquo;hello.out&rsquo; from file &lsquo;hello.c&rsquo; -o specifies the output file. Specify Language: Create a C file and save it as &lsquo;hello.cpp&rsquo;.
gcc -o hello.out hello.cpp  This results in an error as gcc tries to perform C&#43;&#43; compilation(assumed from the extension .">


<meta itemprop="datePublished" content="2010-06-06T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2010-06-06T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="902">



<meta itemprop="keywords" content="C,gcc,linux," />
<meta property="og:title" content="A quick introduction to GCC" />
<meta property="og:description" content="GCC - GNU Compiler Collection From GCC manual - When you invoke GCC, it normally does preprocessing, compilation, assembly and linking. Compile and Link a simple program:
gcc -o hello.out hello.c  This creates an executable &lsquo;hello.out&rsquo; from file &lsquo;hello.c&rsquo; -o specifies the output file. Specify Language: Create a C file and save it as &lsquo;hello.cpp&rsquo;.
gcc -o hello.out hello.cpp  This results in an error as gcc tries to perform C&#43;&#43; compilation(assumed from the extension ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sinujohn.github.io/2010/06/06/a-quick-introduction-to-gcc/" />

<meta property="og:image" content="https://sinujohn.github.io/" />
<meta property="article:published_time" content="2010-06-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2010-06-06T00:00:00+00:00" /><meta property="og:site_name" content="Sinu John" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sinujohn.github.io/"/>

<meta name="twitter:title" content="A quick introduction to GCC"/>
<meta name="twitter:description" content="GCC - GNU Compiler Collection From GCC manual - When you invoke GCC, it normally does preprocessing, compilation, assembly and linking. Compile and Link a simple program:
gcc -o hello.out hello.c  This creates an executable &lsquo;hello.out&rsquo; from file &lsquo;hello.c&rsquo; -o specifies the output file. Specify Language: Create a C file and save it as &lsquo;hello.cpp&rsquo;.
gcc -o hello.out hello.cpp  This results in an error as gcc tries to perform C&#43;&#43; compilation(assumed from the extension ."/>



    <meta property="article:section" content="Tuts" />



    <meta property="article:published_time" content="2010-06-06 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://sinujohn.github.io/post/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://sinujohn.github.io/2010/06/06/a-quick-introduction-to-gcc/">A quick introduction to GCC</a></h2>

            

            <div class="post-content">
                <p><strong><a href="http://gcc.gnu.org/" target="_blank">GCC</a> - GNU Compiler Collection</strong>
From GCC manual - <em>When you invoke GCC, it normally does preprocessing, compilation, assembly and linking.</em>
<h2>Compile and Link a simple program:</h2></p>

<pre><code>gcc -o hello.out hello.c
</code></pre>

<p>This creates an executable &lsquo;hello.out&rsquo; from file &lsquo;hello.c&rsquo;
-o specifies the output file.
<h3><strong>Specify Language:</strong></h3>
Create a C file and save it as &lsquo;hello.cpp&rsquo;.</p>

<pre><code>gcc -o hello.out hello.cpp
</code></pre>

<p>This results in an error as gcc tries to perform C++ compilation(assumed from the extension .cpp).
We can specify that the file is a C file as follows:</p>

<pre><code>gcc -x c -o hello.out hello.cpp
</code></pre>

<p>-x specifies the language.
<h3><strong>Compile Only(No Linking):</strong></h3></p>

<pre><code>gcc -c hello.c
</code></pre>

<p>-c tells gcc to compile ONLY. This creates &lsquo;hello.o&rsquo;, which is an object file.
<h2>Compiling and Linking multiple files:</h2>
File: hello.c</p>

<pre><code>#include&lt;stdio.h&gt;

long myabs(long);
long factorial(long);

int main()
{
 printf(&quot;Hello World..\n&quot;);
 printf(&quot;Absolute(-3) = %d\nFactorial(5) = %d\n&quot;,myabs(-3),factorial(5));
 return 0;
}
</code></pre>

<p>File: myabs.c</p>

<pre><code>long myabs(long a)
{
 if(a&lt;0) return -a;
 return a;
}
</code></pre>

<p>File: myfac.c</p>

<pre><code>long factorial(long no)
{
 if(no&lt;=1) return 1;
 else return no*factorial(no-1);
}
</code></pre>

<p><strong>METHOD 1: Use source files directly:</strong>
Make executable hello.out from 3 files by</p>

<pre><code> gcc -o hello.out hello.c myabs.c myfac.c
</code></pre>

<p><strong>METHOD 2: Use a source file with one or more object files:</strong>
Compile one file</p>

<pre><code> gcc -c myabs.c
</code></pre>

<p>Now object code of myabs.c is obtained. Use this in usual gcc command:</p>

<pre><code> gcc -o hello.out hello.c myabs.o myfac.c
</code></pre>

<p>Or you can compile remaining files also and use their object files:</p>

<pre><code> gcc -o hello.out hello.c myabs.o myfac.o
 gcc -o hello.out hello.o myabs.o myfac.o
</code></pre>

<p><h2>Create Library:</h2>
The above methods are suitable if the number of source files are really small. But if there are large number of source files, then its difficult to specify them each and every time you compile. To make this easy, you can create library.
Library is a collection of object files. Create library with &lsquo;ar&rsquo; command, which is short for &lsquo;archive&rsquo;.
So first create object files (.o files). With above example we have two object files - myabs.o and myfac.o. Now create library:</p>

<pre><code> ar cr libMyCol.a myabs.o myfac.o
</code></pre>

<p>Now a library libMyCol.a is created. To see the contents of a library use &lsquo;ar t&rsquo;:</p>

<pre><code> ar t libMyCol.a
</code></pre>

<p>It will show the present contents (myabs.o and myfac.o).</p>

<p>Compile using the library:</p>

<pre><code> gcc -o hello.out hello.c libMyCol.a
</code></pre>

<p>OR</p>

<pre><code> gcc -o hello.out hello.c -L. -lMyCol
</code></pre>

<p>-L<span style="text-decoration:underline;">dir</span> specifies the direcory in which library files are present. Here we use current directory, so we use a &lsquo;dot&rsquo; as directory.
-l<span style="text-decoration:underline;">library</span> specifies the library name. library should only contain library name - extensions and preceeding &lsquo;lib&rsquo; is omitted. So here &lsquo;libMyCol.a&rsquo; is represented by -lMyCol   . This is why library names should start with &lsquo;lib&rsquo;.
<h2>Create Shared Library:</h2>
To create shared libraries, object files must be created with -fPIC.
From gcc manual :
<em>-fpic
Generate position-independent code (PIC) suitable for use in a shared library, if supported for the target machine.  Such code accesses all constant addresses through a global offset table (GOT). The dynamic loader resolves the GOT entries when the program starts (the dynamic loader is not part of GCC; it is part of the operating system).  If the GOT size for the linked executable exceeds a machine-specific maximum size, you get an error message from the linker indicating that -fpic does not work; in that case, recompile with -fPIC instead.</em></p>

<p>Here we use -fPIC
Before continuing delete all files except the three C files - it looks nice to have a clean directory :)</p>

<p><strong>STEP 1: Create object files as follows:</strong></p>

<pre><code> gcc -c -fPIC myabs.c
 gcc -c -fPIC myfac.c
</code></pre>

<p><strong>STEP 2: Now we create shared library or shared object(.so) file from the two .o files created above.</strong></p>

<pre><code>gcc -shared -o libMyCol.so myabs.o myfac.o
</code></pre>

<p>The shared library created is libMyCol.so. You can delete the .o files as they are no longer needed.</p>

<p>The Shared Library can be linked either Statically or Dynamically.
<h2>Static Linking of Shared Library:</h2>
<strong>METHOD 1: Give full path to .so file</strong></p>

<pre><code> gcc -o hello.out hello.c ./libMyCol.so
</code></pre>

<p><strong>METHOD 2: Use LD_LIBRARY_PATH environment variable</strong></p>

<p>First set LD_LIBRARY_PATH variable to current directory (dot). Then export it. These two steps are shown below:</p>

<pre><code>LD_LIBRARY_PATH=.
 export LD_LIBRARY_PATH
</code></pre>

<p>Now you can perform the final compilation and linking as follows:</p>

<pre><code> gcc -o hello.out hello.c libMyCol.so
</code></pre>

<p><h2>Dynamic Linking of Shared Library:</h2>
To do dynamic linking, you need to modify the source file &lsquo;hello.c&rsquo; as follows:</p>

<p>File: hello.c</p>

<pre><code>#include&lt;stdio.h&gt;
#include&lt;dlfcn.h&gt;

typedef long (*FUN_PTR)(long);

int main()
{
 void *handle = dlopen(&quot;libMyCol.so&quot;,RTLD_LAZY);
 if(handle==0)
 {
  printf(&quot;ERROR: Failed to load the library\n&quot;);
  return -1;
 }
 FUN_PTR fptr1 = dlsym(handle,&quot;myabs&quot;);
 FUN_PTR fptr2 = dlsym(handle,&quot;factorial&quot;);
 if(fptr1==0 || fptr2==0)
 {
  printf(&quot;ERROR: Cannot retrieve function address\n&quot;);
  return -1;
 }
 long tp = (*fptr1)(-3);
 printf(&quot;Hello World..\n&quot;);
 printf(&quot;Absolute(-3) = %d&quot;,tp);
 tp = (*fptr2)(5);
 printf(&quot;\nFactorial(5) = %d\n&quot;,tp);
 dlclose(handle);
 return 0;
}
</code></pre>

<p>If you haven&rsquo;t set LD_LIBRARY_PATH variable and exported it as mentioned above, then do it now.
Now perform dynamic linking by</p>

<pre><code> gcc -o hello.out hello.c -ldl
</code></pre>

<p>dl is the dynamic linking library. -ldl asks gcc to use this library.</p>

<p>Dynamic Linking library provides 4 functions - dlopen, dlclose, dlsym and dlerror. These are in dlfcn.h.
dlopen is used to open a .so file. It returns a handle to the file.
FUN_PTR is a function pointer. fptr1 has address of function myabs().
dlsym takes two parameters - handle and function name.
dlclose is used to close the .so file.</p>

<p>Thanks to <a href="http://praseedp.blogspot.com/" target="_blank">Praseed.P</a> for his session on GCC at <a href="http://www.ilug-cochin.org/" target="_blank">ILUG Cochin</a>. It had been very informative and this post is a result of that session.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://sinujohn.github.io/tags/c">C</a></span><span class="tag"><a href="https://sinujohn.github.io/tags/gcc">gcc</a></span><span class="tag"><a href="https://sinujohn.github.io/tags/linux">linux</a></span>
  				</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://sinujohn.github.io/">Sinu John</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a></span>
            <span> <a href="https://sinujohn.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-96151225-1', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
